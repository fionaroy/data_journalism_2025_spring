---
title: "data_analysis"
author: "Mira Beinart"
date: "2025-04-26"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)  
library(knitr)      
library(lubridate)
library(janitor)
library(ggplot2)
```

```{r}
detail_sod <- read_csv("data/detail_sod.csv")
```

#fixing dates

```{r}
detail_sod <- detail_sod %>%
  mutate(TRANSACTION_DATE=dmy(TRANSACTION_DATE))
```

```{r}
 detail_sod <- detail_sod %>%
  mutate(PERFORM_START_DT=dmy(PERFORM_START_DT))
```

```{r}
detail_sod <- detail_sod %>%
  mutate(PERFORM_END_DT=dmy(PERFORM_END_DT))
```

```{r}
write_csv(detail_sod, "data/detail_sod_clean.csv")
```

```{r}
detail_sod_clean <- read_csv("detail_sod_clean.csv")

glimpse(detail_sod_clean)
```

information: - columns: 18 - rows: 129,843 - limitations: the data doesn't include any party affiliations, which would be helpful for analysis down the line (eg. looking at spending trends between parties, etc). also, the data only includes expenditures from the second half of 2024, so we will probably need to find more data to analyze trends over a longer period of time. \*\*the information is the same in the summary vs the detail dataframe, the difference is the size of the data - the summary dataframe has 5 columns with 6,676 rows

```{r}
summary_sod <- read_csv("data/summary_sod.csv")

glimpse(summary_sod)
```


```{r}
#looking at expenditures between the House Caucuses in 2024 
party_caucus <- detail_sod |>
  filter(ORGANIZATION %in% c("2024 DEMOCRATIC CAUCUS", "2024 REPUBLICAN CONFERENCE"))

#spending between the caucuses
party_caucus |>
   group_by(ORGANIZATION) |>
  summarise(total_spent = sum(AMOUNT, na.rm = TRUE)) |>
  arrange(desc(total_spent))
```
```{r}
 party_caucus |>
  group_by(ORGANIZATION, SORT_SUBTOTAL_DESCRIPTION) |>
  summarise(category_spent = sum(AMOUNT, na.rm = TRUE)) |>
  arrange(desc(category_spent))
```

```{r}
#make a chart! #thanks chat for helping me out with this one
party_caucus |>
  group_by(ORGANIZATION, SORT_SUBTOTAL_DESCRIPTION) |>
  summarise(category_spent = sum(AMOUNT, na.rm = TRUE), .groups = "drop") |>
  ggplot(aes(x = reorder(SORT_SUBTOTAL_DESCRIPTION, -category_spent),
             y = category_spent,
             fill = ORGANIZATION)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(x = "Spending Category", y = "Total Spent",
       title = "2024 Expenditures by House Caucuses") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

```{r}
party_caucus |>
  group_by(ORGANIZATION, DESCRIPTION) |>
  summarise(count = n(), total_spent = sum(AMOUNT, na.rm = TRUE),.groups = "drop") |>
  arrange(desc(total_spent))

write_csv(party_caucus, "data/party_caucus.csv")
```

Basically what I did here was I wanted to look at the spending between the House Caucuses in 2024 (Republican and Democrat). First I made a new dataset with just the rows from the caucuses. Then I looked at the spending based on the category and made a bar chart!I was interested that Democrats spent a lot more than Republicans on personal compensation. Then there's another column called DESCRIPTION which has a more specific description of the expenditures. I put the dataset into OpenRefine to see if it could find any clusters but it failed on me. I then tried asking Chat to do it and it did not. I need to figure out how to group these - it might have to be manually but I will do that for the next assignment. Overall it's clear that Democrats spent more paying their employees than Republicans, which is super interesting/fascinating/peculiar/I want to know why. 