---
title: "lab_10"
author: "Derek Willis"
date: "2024-11-06"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## You will need

-   the tidyverse, janitor and tigris libraries
-   you might choose to use the tidycensus library for Q3

## Load libraries and establish settings

**Task** Create a codeblock and load appropriate packages and settings for this lab.

```{r}
# Turn off scientific notation
options(scipen=999)

# Load libraries
library(tidyverse)
library(sf)
library(janitor)
library(tigris)
library(tidycensus)
library(dplyr)
```

Let's explore the election results from last night and make some maps!

## Questions

**Q1.** Make a county-level map of Maryland's results for U.S. Senate using `md_senate_county_24.csv` in the data folder, calculating the difference between Angela Alsobrooks's percentage of the total votes and Larry Hogan's percentage of the total votes and displaying that percentage difference on the map. What is the story here, and what is the county with the most interesting results?

**A1.** The county with the most interesting results, to me at least, is Baltimore County. From what I know about Maryland politics (as a out of state student who still doesn't know everything about each county's party preference), I've been inclined to believe that both Baltimore City and Baltimore county are both pretty Democrat leaning. So, out of all of the percent differences between all the counties, I think Baltimore County being very borderline on it's percent difference in voting between Hogan and Alsobrooks surprises me. I would have thought that it would have been more Alsobrooks leaning (and in terms of color for my map, more yellow). So, with this response I think that the story here would be why, in counties most known for leaning one particular way or another, were there some very small margins for percent difference in voting for either Hogan or Alsobrooks. What was it about each candidate, in this senate race, that was or was not swaying the constituents? 

```{r}
##loading the csv file##
md_senate_county_24 <- read_csv("data/md_senate_county_24.csv")

glimpse(md_senate_county_24)
##cleaning not necessary##
```

```{r}
##calculating total votes in md, percent of total votes for alsobrooks and hogan, and percent difference##
md_senate_county_24 <- md_senate_county_24 |>
  mutate(
    total_votes = Alsobrooks + Hogan + Scott,
    alsobrooks_pct = (Alsobrooks/total_votes)*100,
    hogan_pct = (Hogan/total_votes)*100,
    pct_diff = alsobrooks_pct - hogan_pct
  )

```

```{r}
##loading MD county shapefile to make necessary map##
md_counties <- get_acs(geography = "county",
              variables = c(population = "B01001_001"),
              state = "MD",
              year = 2022,
              geometry = TRUE)

```

```{r}
##creation of dataframe for more specific/better county map##
md_counties <- md_counties |>
  rename(County = NAME) |>
  mutate(County = str_to_title(str_remove_all(County,", Maryland|County"))) |>
  mutate(County = str_trim(County,side="both")) |>
  rename(population = estimate) |>
  select(County, population, geometry)

```


```{r}
##joining the csv file with the MD shapefile so mapping is possible##
md_senate_map <- md_counties |>
  left_join(md_senate_county_24)

```

```{r}
##mutating/cleaning issues of names between the two og dataframes so no NA's##
md_counties <- md_counties |>
  mutate(County = if_else(County == "St. Mary's", "Saint Mary's", County)) |> 
  mutate(County = if_else(County == "Baltimore", "Baltimore County", County))
```


```{r}
##making of my beautiful map##
ggplot() +
  geom_sf(data=md_senate_map, aes(fill=pct_diff)) +
  theme_minimal() +
  scale_fill_viridis_b(option="magma")

```

**Q2.** Make a county-level map showing the difference between Donald Trump's county-level performance this year and Larry Hogan's, using percentages to compare the two as you did in Q1. You can use the dataframe you initially loaded for Q1, and you'll need to load the 2024 presidential results in the data folder and join them to it before proceeding. Are there any counties where Trump got a higher percentage than Hogan? How would you describe the map showing the Trump-Hogan difference?

Also answer this: is a map the best way to present this data? What else could you make that might convey more information?

**A2.** The counties where Trump got a higher percentage of votes than Hogan are just Allegany County with a 0.30% difference in favor of Trump. Other than than, every other county, whether to a small or very large degree, seemed to favor a larger percentage difference in voting for Hogan for senate rather than Trump for president. In fact, 16 counties heavily voted more in favor of Hogan for Senate than Trump for president. In regard to the map itself, I think that this is a decent way to present this data, but I do not think it is in anyway the best way to visualize this data. For this type of comparison, between two different types of races (i.e. two different positions), I think that a chart (bar, line, scatter, etc.) would be much better at providing a comparative visual analysis of this percent difference between the two for readers.

```{r}
##loading new csv for question##
md_pres_county_24 <- read_csv("data/md_pres_county_24.csv")

glimpse(md_pres_county_24)
##looks fine, no cleaning necessary rn##
```

```{r}
##making new dataframe from senate race to just include hogan information##
hogan_map <- md_senate_map |>
  select(-Alsobrooks, -Scott, -alsobrooks_pct, -pct_diff, -total_votes)

```

```{r}
##making percent total vote for trump dataframe##
md_pres_county_24 <- md_pres_county_24 |>
  mutate(
    total_pres = Harris + Trump + Oliver + Stein + Kennedy,
    trump_pct = (Trump/total_pres)*100
  ) |>
  select(County, trump_pct)

```

```{r}
##joining data together##
hogan_trump_compare_map <- left_join(md_pres_county_24, hogan_map, by = "County") |>
  mutate(pct_HT_diff = trump_pct - hogan_pct)

```

```{r}
##fixing geom issue; consulted chat w/ permission##
class(hogan_trump_compare_map)

hogan_trump_compare_map <- st_as_sf(hogan_trump_compare_map)
```

```{r}
##making hogan-trump map; assistance from chat to make boundary lines more apparent so easier to read##
ggplot() +
 geom_sf(data=hogan_trump_compare_map, aes(fill=pct_HT_diff), color = "grey", size = 0.5) +
  theme_minimal() +
  scale_fill_viridis_b(option="magma")

```


**Q3** Make another map showing the difference between Larry Hogan's county-level performance this year and from his governor race in 2018, using percentages to compare the two as you did in Q2. You can use the dataframe you initially loaded for Q1, and you'll need to load the 2018 governor results in the data folder and join them to it before proceeding. Are there any counties where Hogan did better this year? How would you describe the map showing the difference?

**A3**  No, it does not appear that there are any counties in which Hogan did better this year over his 2018 run for governor. The map shows this difference first through the key which signifies that there is not one positive number, only negative percent differences between 24-18. Thus, this means that a positive number correlating with one of the colors would have showed a county in which Hogan performed better in 2024, but due to no positive percent differences being present, only negative percent differences, it is without a doubt true that Hogan performed significantly better in 2018. Additionally, only five of the 24 counties show Hogan having a smaller negative percentage difference in the first place which is in comparison to the 19 counties with larger negative differences. 

```{r}
##uploading Hogan performance gov race 2018 csv##
md_gov_county_18 <- read_csv("data/md_gov_county_18.csv")

glimpse(md_gov_county_18)
```

```{r}
##clean write-in spacing##
md_gov_county_18 <- md_gov_county_18 |>
  rename(Write_ins = 'Write-ins')

```

```{r}
##once again, just pulling hogan senate '24 info from Q1 for a new dataframe##
hogan_senate <- md_senate_map |>
  select(-Alsobrooks, -Scott, -alsobrooks_pct, -pct_diff, -total_votes)

```

```{r}
##making percent total vote for hogan gov 18 dataframe##
md_gov_county_18 <- md_gov_county_18 |>
  mutate(
    total_gov = Hogan + Jealous + Quinn + Schlakman + Write_ins,
    hogan_gov_pct = (Hogan/total_gov)*100
  ) |>
  select(County, hogan_gov_pct)
```

```{r}
##joining data together##
hogan_senate_gov_compare_map <- left_join(hogan_senate, md_gov_county_18, by = "County") |>
  mutate(pct_Hsg_diff = hogan_pct - hogan_gov_pct)
```

```{r}
##mutating/cleaning issues of names between the two og dataframes so no NA's##
hogan_senate_gov_compare_map <- hogan_senate_gov_compare_map |>
  mutate(County = if_else(County == "St. Mary's", "Saint Mary's", County))

```

```{r}
##fixing geom issue; consulted chat##
class(hogan_senate_gov_compare_map)

hogan_senate_gov_compare_map <- st_as_sf(hogan_senate_gov_compare_map)
```
```{r}
##making hogan senator v. gov map; assistance from chat to make boundary lines more apparent so easier to read##
ggplot() +
 geom_sf(data=hogan_senate_gov_compare_map, aes(fill=pct_Hsg_diff), color = "grey", size = 0.5) +
  theme_minimal() +
  scale_fill_viridis_b(option="magma")

```

**Q4.** Choose your own map adventure! In the data folder I've included Maryland county-level results for the abortion rights amendment vote this year, plus the 2020 presidential results by county and 2022 governor's results by county. Using one of those and at least one other contest for comparison, make a county-level map showing what you think is the most interesting aspect of that data, and describe the results in terms of a possible story. You can bring in other data, such as Census information, if you like.

**A4.** For this question I chose to compare the percentage of votes in the 2024 and 2020 presidential elections, with a focus on MD county votes for Trump. What I found is that across the whole state, in each county, there was a decent percentage increase in votes for trump from the year 2020 - 2024. In every county, voting for Trump for president increased by a minimum of 1.93% at the lowest increase (Charles County), and the highest increase of 8.04% (Cecil County). I think this could be an interesting/possible story because it shows that a heavily democratic state, Maryland, had across-the-board increased voting for a Republican candidate for president, and it would be interesting to use this data to find the counties with the smallest and largest changes in voting patterns to see why this might be.

```{r}
##uploading csv##
md_pres_county_20 <- read_csv("data/md_pres_county_20.csv")

glimpse(md_pres_county_20)
```

```{r}
##making percent total vote for trump dataframe 2020##
md_pres_county_20 <- md_pres_county_20 |>
  mutate(
    total_president = Biden + Trump + Jorgensen + Hawkins + Segal,
    trump_pct_20 = (Trump/total_president)*100
  ) |>
  select(County, trump_pct_20)

```

```{r}
##joining data together##
trump_yearly_compare_map <- left_join(md_pres_county_20, md_pres_county_24, by = "County") |>
  mutate(pct_trump_diff = trump_pct - trump_pct_20)

```

```{r}
##loading MD county shapefile to make necessary map##
md_counties_t <- get_acs(geography = "county",
              variables = c(population = "B01001_001"),
              state = "MD",
              year = 2022,
              geometry = TRUE)
```

```{r}
##creation of dataframe for more specific/better county map##
md_counties_t <- md_counties_t |>
  rename(County = NAME) |>
  mutate(County = str_to_title(str_remove_all(County,", Maryland|County"))) |>
  mutate(County = str_trim(County,side="both")) |>
  rename(population = estimate) |>
  select(County, population, geometry)

```


```{r}
##joining the csv file with the MD shapefile so mapping is possible##
trump_pres_map_year <- md_counties_t |>
  left_join(trump_yearly_compare_map)

```
```{r}
##mutating/cleaning issues of names between the two og dataframes so no NA's##
md_counties_t <- md_counties_t |>
  mutate(County = if_else(County == "St. Mary's", "Saint Mary's", County)) |> 
  mutate(County = if_else(County == "Baltimore", "Baltimore County", County))
```

```{r}
##making hogan-trump map; assistance from chat to make boundary lines more apparent so easier to read##
ggplot() +
 geom_sf(data=trump_pres_map_year, aes(fill=pct_trump_diff), color = "grey", size = 0.5) +
  theme_minimal() +
  scale_fill_viridis_b(option="magma")

```

-30-





